<!DOCTYPE html>
<meta charset="utf-8">
<title>Spline Editor</title>
<style>

body {
  font: 13px sans-serif;
  position: relative;
  width: 960px;
  height: 500px;
  background-color: #232328;
}

form {
  position: absolute;
  bottom: 10px;
  left: 10px;
}

rect {
  fill: none;
  pointer-events: all;
}

.grabber {
  cursor: pointer;
  fill: red;
}

.line {
  fill: none;
  stroke: #59556c;
  stroke-width: 3px;
  stroke-linecap: round;
  stroke-linejoin: round;
  stroke-miterlimit: 10px;
}
.blackline {
  fill: none;
  stroke: #817c98;
  stroke-width: 3px;
  stroke-linecap: round;
  stroke-linejoin: round;
  stroke-miterlimit: 10px;
}

.circle {
  fill: #8c87a5;
}
.dot {
  fill: #59556c;
}

.selected {
  fill: #ff7f0e;
  stroke: #ff7f0e;
}

</style>
<div></div>
<script src="/d3.min.js"></script>
<script>

var width = 1200,
    height = 900;
var scale = 1;
var toggle = true;
var initialized = false;

var zeropoints = [
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.9, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -1.4, 0], 
  [0, 0, 0, 0, -1.6, 0], 
  [0, 0, 0, 0, -1.6, 0], 
  [0, 0, 0, 0, -1.3, 0], 
  [0, 0, 0, 0, -1, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.9, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -1.2, 0], 
  [0, 0, 0, 0, -1.4, 0], 
  [0, 0, 0, 0, -1.5, 0], 
  [0, 0, 0, 0, -1.4, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -1.5, 0], 
  [0, 0, 0, 0, -1.8, 0], 
  [0, 0, 0, 0, -2.1, 0], 
  [0, 0, 0, 0, -2.3, 0], 
  [0, 0, 0, 0, -2.5, 0], 
  [0, 0, 0, 0, -2.6, 0], 
  [0, 0, 0, 0, -2.4, 0], 
  [0, 0, 0, 0, -1.9, 0], 
  [0, 0, 0, 0, -1.4, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, 0.4, 0], 
  [0, 0, 0, 0, 0.7, 0], 
  [0, 0, 0, 0, 0.9, 0], 
  [0, 0, 0, 0, 0.8, 0], 
  [0, 0, 0, 0, 0.6, 0], 
  [0, 0, 0, 0, 0.3, 0], 
  [0, 0, 0, 0, 3.3, 0], 
  [0, 0, 0, 0, 2.4, 0], 
  [0, 0, 0, 0, 1.8, 0], 
  [0, 0, 0, 0, 1.2, 0], 
  [0, 0, 0, 0, 0.7, 0], 
  [0, 0, 0, 0, 0.4, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.9, 0], 
  [0, 0, 0, 0, -1.2, 0], 
  [0, 0, 0, 0, -1.3, 0], 
  [0, 0, 0, 0, -1.3, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.9, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0.2, 0], 
  [0, 0, 0, 0, 0.4, 0], 
  [0, 0, 0, 0, 0.6, 0], 
  [0, 0, 0, 0, 0.8, 0], 
  [0, 0, 0, 0, 1, 0], 
  [0, 0, 0, 0, 1.1, 0], 
  [0, 0, 0, 0, 1.3, 0], 
  [0, 0, 0, 0, 1.5, 0], 
  [0, 0, 0, 0, 1.7, 0], 
  [0, 0, 0, 0, 1.7, 0], 
  [0, 0, 0, 0, 1.4, 0], 
  [0, 0, 0, 0, 1.1, 0], 
  [0, 0, 0, 0, 0.9, 0], 
  [0, 0, 0, 0, 0.7, 0], 
  [0, 0, 0, 0, 0.5, 0], 
  [0, 0, 0, 0, 0.3, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.9, 0], 
  [0, 0, 0, 0, -1, 0], 
  [0, 0, 0, 0, -1, 0], 
  [0, 0, 0, 0, -0.9, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -2.4, 0], 
  [0, 0, 0, 0, -2, 0], 
  [0, 0, 0, 0, -1.6, 0], 
  [0, 0, 0, 0, -1.2, 0], 
  [0, 0, 0, 0, -0.9, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.9, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -1.2, 0], 
  [0, 0, 0, 0, -1.4, 0], 
  [0, 0, 0, 0, -1.5, 0], 
  [0, 0, 0, 0, -1.4, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -1.5, 0], 
  [0, 0, 0, 0, -1.8, 0], 
  [0, 0, 0, 0, -2.1, 0], 
  [0, 0, 0, 0, -2.3, 0], 
  [0, 0, 0, 0, -2.5, 0], 
  [0, 0, 0, 0, -2.6, 0], 
  [0, 0, 0, 0, -2.4, 0], 
  [0, 0, 0, 0, -1.9, 0], 
  [0, 0, 0, 0, -1.4, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, 0.4, 0], 
  [0, 0, 0, 0, 0.7, 0], 
  [0, 0, 0, 0, 0.9, 0], 
  [0, 0, 0, 0, 0.8, 0], 
  [0, 0, 0, 0, 0.6, 0], 
  [0, 0, 0, 0, 0.3, 0], 
  [0, 0, 0, 0, 3.3, 0], 
  [0, 0, 0, 0, 2.4, 0], 
  [0, 0, 0, 0, 1.8, 0], 
  [0, 0, 0, 0, 1.2, 0], 
  [0, 0, 0, 0, 0.7, 0], 
  [0, 0, 0, 0, 0.4, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0.1, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.9, 0], 
  [0, 0, 0, 0, -1.2, 0], 
  [0, 0, 0, 0, -1.3, 0], 
  [0, 0, 0, 0, -1.3, 0], 
  [0, 0, 0, 0, -1.1, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.1, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.7, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.9, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.8, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.6, 0], 
  [0, 0, 0, 0, -0.5, 0], 
  [0, 0, 0, 0, -0.4, 0], 
  [0, 0, 0, 0, -0.3, 0], 
  [0, 0, 0, 0, -0.2, 0], 
  [0, 0, 0, 0, 0, 0], 
  [0, 0, 0, 0, 0.2, 0], 
  [0, 0, 0, 0, 0.4, 0], 
  [0, 0, 0, 0, 0.6, 0], 
  [0, 0, 0, 0, 0.8, 0], 
  [0, 0, 0, 0, 1, 0], 
  [0, 0, 0, 0, 1.1, 0], 
  [0, 0, 0, 0, 1.3, 0], 
  [0, 0, 0, 0, 1.5, 0], 
  [0, 0, 0, 0, 1.7, 0], 
  [0, 0, 0, 0, 1.7, 0], 
  [0, 0, 0, 0, 1.4, 0], 
  [0, 0, 0, 0, 1.2, 0], 
  [0, 0, 0, 0, 0.9, 0], 
  [0, 0, 0, 0, 0.7, 0], 
  [0, 0, 0, 0, 0.5, 0], 
  [0, 0, 0, 0, 0.3, 0], 
  [0, 0, 0, 0, 0.1, 0]
];

var newpoints = [
 [0, 0, 0, 0.1, 0, 0.2], 
 [0, 0.2, 0, 0.4, -0.1, 0.7], 
 [0, 0.3, -0.1, 0.6, -0.1, 1], 
 [0, 0, -0.1, 0.8, -0.2, 1.3], 
 [0, 0, -0.1, 0.9, -0.2, 1.4], 
 [-0.1, 0.5, -0.2, 1, -0.2, 1.5], 
 [-0.1, 0.5, -0.2, 1, -0.3, 1.4], 
 [-0.1, 0.5, -0.2, 0.9, -0.3, 1.3], 
 [0, 0, -0.2, 0.8, -0.3, 1.3], 
 [-0.1, 0.4, -0.3, 0.9, -0.4, 1.4], 
 [-0.2, 0.5, -0.3, 0.9, -0.6, 1.4], 
 [0, 0, -0.4, 0.9, -0.7, 1.4], 
 [-0.3, 0.4, -0.6, 0.9, -0.9, 1.3], 
 [-0.3, 0.4, -0.7, 0.8, -1.1, 1.1], 
 [-0.4, 0.3, -0.9, 0.7, -1.4, 0.9], 
 [-0.5, 0.3, -1, 0.5, -1.6, 0.6], 
 [-0.6, 0.2, -1.1, 0.2, -1.6, 0.1], 
 [-0.5, -0.1, -0.9, -0.3, -1.3, -0.6], 
 [-0.4, -0.3, -0.7, -0.6, -1, -1], 
 [-0.3, -0.4, -0.5, -0.8, -0.7, -1.3], 
 [0, 0, -0.4, -0.9, -0.5, -1.4], 
 [0, 0, -0.2, -0.9, -0.3, -1.2], 
 [0, 0, -0.1, -0.7, -0.2, -0.9], 
 [0, -0.2, 0, -0.3, 0, -0.3], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, -4.6], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 0, 0, 0, 0, 3.9], 
 [0, 1.3, -0.1, 2.5, -0.3, 3.6], 
 [-0.1, 1.1, -0.3, 2.2, -0.5, 3.3], 
 [-0.2, 1, -0.5, 2, -0.7, 2.9], 
 [-0.3, 0.9, -0.6, 1.7, -0.9, 2.5], 
 [-0.3, 0.7, -0.7, 1.4, -1.1, 2], 
 [0, 0, -0.8, 1.1, -1.2, 1.5], 
 [-0.4, 0.4, -0.9, 0.8, -1.4, 1], 
 [0, 0, -1, 0.4, -1.5, 0.5], 
 [-0.5, 0.1, -1, 0, -1.4, -0.1], 
 [-0.4, -0.2, -0.8, -0.4, -1.1, -0.7], 
 [-0.3, -0.3, -0.6, -0.7, -0.8, -1.1], 
 [-0.2, -0.4, -0.4, -0.8, -0.6, -1.3], 
 [0, 0, -0.3, -0.9, -0.4, -1.3], 
 [-0.1, -0.4, -0.2, -0.8, -0.3, -1.2], 
 [-0.1, -0.3, -0.1, -0.6, -0.1, -0.8], 
 [0, -0.2, 0, -0.3, 0, -0.3], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0.1, 0, 0.4], 
 [0, 0.3, 0, 0.7, 0, 1.2], 
 [0, 0.5, 0, 1.1, 0, 1.8], 
 [0, 0, 0, 1.5, 0, 2.3], 
 [0, 0.8, 0, 1.7, 0, 2.7], 
 [0, 0.9, 0, 1.9, 0, 2.9], 
 [0, 0, 0, 2, 0, 3], 
 [0, 0, 0, 2, -0.1, 3], 
 [0, 1, -0.1, 1.9, -0.2, 2.8], 
 [-0.1, 0.9, -0.2, 1.8, -0.4, 2.6], 
 [-0.1, 0.8, -0.3, 1.6, -0.5, 2.4], 
 [-0.2, 0.7, -0.4, 1.5, -0.6, 2.1], 
 [-0.2, 0.7, -0.4, 1.3, -0.6, 1.9], 
 [-0.2, 0.6, -0.4, 1.1, -0.6, 1.6], 
 [-0.2, 0.5, -0.4, 1, -0.6, 1.4], 
 [-0.2, 0.4, -0.3, 0.8, -0.4, 1.1], 
 [-0.1, 0.3, -0.3, 0.7, -0.6, 1.2], 
 [0, 0, -0.6, 1, -1.1, 1.6], 
 [-0.4, 0.6, -0.9, 1.2, -1.5, 1.9], 
 [-0.5, 0.6, -1.1, 1.3, -1.8, 2], 
 [-0.6, 0.7, -1.3, 1.3, -2.1, 2], 
 [0, 0, -1.5, 1.3, -2.3, 1.9], 
 [0, 0, -1.6, 1.1, -2.5, 1.6], 
 [-0.8, 0.5, -1.7, 0.9, -2.6, 1.2], 
 [-0.9, 0.3, -1.7, 0.7, -2.4, 1], 
 [-0.7, 0.3, -1.3, 0.7, -1.9, 1], 
 [-0.6, 0.3, -1, 0.7, -1.4, 1], 
 [0, 0, -0.8, 0.6, -1.1, 0.9], 
 [-0.3, 0.3, -0.5, 0.5, -0.7, 0.8], 
 [-0.2, 0.2, -0.4, 0.4, -0.5, 0.6], 
 [-0.1, 0.2, -0.2, 0.3, -0.2, 0.4], 
 [0, 0.1, -0.1, 0.1, -0.1, 0.1], 
 [-0.4, 0.9, -0.6, 1.7, -0.7, 2.4], 
 [-0.1, 0.7, -0.1, 1.4, -0.1, 2], 
 [0.1, 0.6, 0.2, 1.1, 0.4, 1.6], 
 [0.2, 0.5, 0.5, 0.9, 0.7, 1.2], 
 [0.3, 0.3, 0.6, 0.6, 0.9, 0.9], 
 [0.3, 0.2, 0.6, 0.4, 0.8, 0.6], 
 [0.3, 0.1, 0.5, 0.3, 0.6, 0.3], 
 [0, 0, 0.3, 0.1, 0.3, 0.1], 
 [1.2, 0.2, 2.3, 0.2, 3.3, 0.1], 
 [0.9, -0.1, 1.8, -0.4, 2.4, -0.8], 
 [0.7, -0.4, 1.3, -0.9, 1.8, -1.5], 
 [0.5, -0.6, 0.9, -1.2, 1.2, -1.9], 
 [0.3, -0.7, 0.5, -1.3, 0.7, -2], 
 [0.2, -0.6, 0.3, -1.2, 0.4, -1.8], 
 [0.1, -0.5, 0.1, -1, 0.1, -1.3], 
 [0, 0, 0, -0.5, 0, -0.5], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0, 0.1], 
 [0, 0.1, 0, 0.2, 0, 0.5], 
 [0, 0.2, 0, 0.5, 0, 0.9], 
 [0, 0, 0, 0.9, 0, 1.5], 
 [0, 0.6, 0, 1.4, 0, 2.3], 
 [0, 0.9, 0, 1.9, -0.1, 3.1], 
 [0, 0, -0.1, 2.6, -0.1, 4.1], 
 [0, 1.6, -0.1, 3.3, -0.2, 5.3], 
 [-0.1, 2, -0.2, 3.7, -0.5, 5.3], 
 [-0.2, 1.6, -0.5, 2.9, -0.9, 4.1], 
 [0, 0, -0.8, 2.2, -1.2, 3.1], 
 [-0.4, 0.9, -0.9, 1.6, -1.3, 2.2], 
 [-0.4, 0.6, -0.9, 1.1, -1.3, 1.5], 
 [-0.4, 0.4, -0.8, 0.7, -1.1, 0.9], 
 [0, 0, -0.6, 0.4, -0.8, 0.4], 
 [-0.2, 0.1, -0.3, 0.1, -0.3, 0.1], 
 [0, 0, -0.1, 0, -0.1, 0.1], 
 [0, 0, -0.2, 0.1, -0.4, 0.1], 
 [-0.2, 0, -0.4, 0.1, -0.6, 0.1], 
 [-0.2, 0, -0.5, 0, -0.7, 0], 
 [-0.3, 0, -0.5, -0.1, -0.8, -0.1], 
 [-0.3, -0.1, -0.6, -0.2, -0.9, -0.4], 
 [0, 0, -0.6, -0.4, -0.8, -0.7], 
 [-0.3, -0.3, -0.5, -0.6, -0.8, -1], 
 [-0.2, -0.4, -0.4, -0.7, -0.6, -1.2], 
 [-0.2, -0.4, -0.4, -0.9, -0.6, -1.4], 
 [0, 0, -0.3, -1.1, -0.5, -1.7], 
 [-0.2, -0.6, -0.3, -1.3, -0.4, -2], 
 [-0.1, -0.7, -0.2, -1.5, -0.3, -2.3], 
 [0, 0, -0.1, -1.7, -0.2, -2.6], 
 [0, -0.9, 0, -1.9, 0, -2.9], 
 [0, -1, 0.1, -2.1, 0.2, -3.2], 
 [0.1, -1.1, 0.3, -2.2, 0.4, -3.2], 
 [0.2, -1, 0.4, -1.9, 0.6, -2.7], 
 [0.2, -0.8, 0.5, -1.6, 0.8, -2.3], 
 [0.3, -0.7, 0.6, -1.3, 1, -1.9], 
 [0, 0, 0.7, -1.1, 1.1, -1.5], 
 [0.4, -0.4, 0.9, -0.8, 1.3, -1.1], 
 [0.5, -0.3, 1, -0.5, 1.5, -0.7], 
 [0.5, -0.2, 1.1, -0.3, 1.7, -0.3], 
 [0.6, 0, 1.2, 0, 1.7, 0.1], 
 [0.5, 0.1, 1, 0.3, 1.4, 0.6], 
 [0.4, 0.2, 0.8, 0.5, 1.1, 0.9], 
 [0.3, 0.3, 0.6, 0.7, 0.9, 1], 
 [0.3, 0.4, 0.5, 0.7, 0.7, 1], 
 [0.2, 0.3, 0.3, 0.6, 0.5, 0.9], 
 [0.1, 0.3, 0.2, 0.5, 0.3, 0.7], 
 [0.1, 0.2, 0.1, 0.2, 0.1, 0.2], 
 [-0.2, -0.7, -0.5, -1.4, -0.8, -2], 
 [-0.3, -0.6, -0.6, -1, -0.9, -1.4], 
 [-0.3, -0.4, -0.7, -0.7, -1, -1], 
 [-0.3, -0.3, -0.7, -0.5, -1, -0.6], 
 [-0.3, -0.2, -0.6, -0.3, -0.9, -0.4], 
 [-0.3, -0.1, -0.5, -0.1, -0.7, -0.2], 
 [0, 0, -0.4, 0, -0.5, 0], 
 [-0.1, 0, -0.2, 0, -0.2, 0], 
 [-0.9, 0, -1.7, 0.1, -2.4, 0.4], 
 [-0.7, 0.3, -1.4, 0.7, -2, 1.2], 
 [-0.6, 0.5, -1.1, 1.2, -1.6, 1.9], 
 [-0.5, 0.7, -0.9, 1.6, -1.2, 2.5], 
 [-0.4, 0.9, -0.7, 1.9, -0.9, 3], 
 [-0.3, 1.1, -0.5, 2.2, -0.6, 3.3], 
 [0, 0, -0.3, 2.4, -0.4, 3.6], 
 [-0.1, 1.2, -0.1, 2.5, -0.1, 3.7], 
 [0, 1.5, -0.1, 2.9, -0.2, 4.3], 
 [0, 0, -0.3, 2.6, -0.4, 3.7], 
 [-0.2, 1.1, -0.4, 2.2, -0.7, 3.1], 
 [0, 0, -0.6, 1.8, -0.9, 2.6], 
 [-0.3, 0.8, -0.7, 1.4, -1.1, 2], 
 [-0.4, 0.6, -0.8, 1.1, -1.2, 1.5], 
 [0, 0, -0.9, 0.7, -1.4, 1], 
 [-0.5, 0.2, -1, 0.4, -1.5, 0.5], 
 [0, 0, -1, 0, -1.4, -0.1], 
 [0, 0, -0.8, -0.4, -1.1, -0.7], 
 [-0.3, -0.3, -0.6, -0.7, -0.8, -1.1], 
 [-0.2, -0.4, -0.4, -0.8, -0.6, -1.3], 
 [0, 0, -0.3, -0.9, -0.4, -1.3], 
 [-0.1, -0.4, -0.2, -0.8, -0.3, -1.2], 
 [-0.1, -0.3, -0.1, -0.6, -0.1, -0.8], 
 [0, -0.2, 0, -0.3, 0, -0.3], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0, 0, -3.1], 
 [0, 0, 0, 0.1, 0, 0.4], 
 [0, 0.3, 0, 0.7, 0, 1.2], 
 [0, 0.5, 0, 1.1, 0, 1.8], 
 [0, 0.7, 0, 1.5, 0, 2.3], 
 [0, 0.8, 0, 1.7, 0, 2.7], 
 [0, 0.9, 0, 1.9, 0, 2.9], 
 [0, 1, 0, 2, 0, 3], 
 [0, 1, 0, 2, -0.1, 3], 
 [0, 1, -0.1, 1.9, -0.2, 2.8], 
 [0, 0, -0.2, 1.8, -0.4, 2.6], 
 [-0.1, 0.8, -0.3, 1.6, -0.5, 2.4], 
 [-0.2, 0.7, -0.4, 1.5, -0.6, 2.1], 
 [-0.2, 0.7, -0.4, 1.3, -0.6, 1.9], 
 [-0.2, 0.6, -0.4, 1.1, -0.6, 1.6], 
 [0, 0, -0.4, 1, -0.6, 1.4], 
 [-0.2, 0.4, -0.3, 0.8, -0.4, 1.1], 
 [-0.1, 0.3, -0.3, 0.7, -0.6, 1.2], 
 [0, 0, -0.6, 1, -1.1, 1.6], 
 [-0.4, 0.6, -0.9, 1.2, -1.5, 1.9], 
 [-0.5, 0.6, -1.1, 1.3, -1.8, 2], 
 [-0.6, 0.7, -1.3, 1.3, -2.1, 2], 
 [-0.7, 0.6, -1.5, 1.3, -2.3, 1.9], 
 [-0.8, 0.6, -1.6, 1.1, -2.5, 1.6], 
 [-0.8, 0.5, -1.7, 0.9, -2.6, 1.2], 
 [-0.9, 0.3, -1.7, 0.7, -2.4, 1], 
 [-0.7, 0.3, -1.3, 0.7, -1.9, 1], 
 [-0.6, 0.3, -1, 0.7, -1.4, 1], 
 [-0.4, 0.3, -0.8, 0.6, -1.1, 0.9], 
 [0, 0, -0.5, 0.5, -0.7, 0.8], 
 [-0.2, 0.2, -0.4, 0.4, -0.5, 0.6], 
 [-0.1, 0.2, -0.2, 0.3, -0.2, 0.4], 
 [0, 0.1, -0.1, 0.1, -0.1, 0.1], 
 [-0.4, 0.9, -0.6, 1.7, -0.7, 2.4], 
 [0, 0, -0.1, 1.4, -0.1, 2], 
 [0.1, 0.6, 0.2, 1.1, 0.4, 1.6], 
 [0.2, 0.5, 0.5, 0.9, 0.7, 1.2], 
 [0.3, 0.3, 0.6, 0.6, 0.9, 0.9], 
 [0.3, 0.2, 0.6, 0.4, 0.8, 0.6], 
 [0.3, 0.1, 0.5, 0.3, 0.6, 0.3], 
 [0, 0, 0.3, 0.1, 0.3, 0.1], 
 [1.2, 0.2, 2.3, 0.2, 3.3, 0.1], 
 [0.9, -0.1, 1.8, -0.4, 2.4, -0.8], 
 [0.7, -0.4, 1.3, -0.9, 1.8, -1.5], 
 [0.5, -0.6, 0.9, -1.2, 1.2, -1.9], 
 [0.3, -0.7, 0.5, -1.3, 0.7, -2], 
 [0.2, -0.6, 0.3, -1.2, 0.4, -1.8], 
 [0.1, -0.5, 0.1, -1, 0.1, -1.3], 
 [0, 0, 0, -0.5, 0, -0.5], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0.1, -5.9], 
 [0, 0, 0, 0, 0, 0.1], 
 [0, 0.1, 0, 0.2, 0, 0.5], 
 [0, 0.2, 0, 0.5, 0, 0.9], 
 [0, 0, 0, 0.9, 0, 1.5], 
 [0, 0.6, 0, 1.4, 0, 2.3], 
 [0, 0.9, 0, 1.9, -0.1, 3.1], 
 [0, 1.2, -0.1, 2.6, -0.1, 4.1], 
 [0, 0, -0.1, 3.3, -0.2, 5.3], 
 [0, 0, -0.2, 3.7, -0.5, 5.3], 
 [-0.2, 1.6, -0.5, 2.9, -0.9, 4.1], 
 [-0.4, 1.2, -0.8, 2.2, -1.2, 3.1], 
 [-0.4, 0.9, -0.9, 1.6, -1.3, 2.2], 
 [0, 0, -0.9, 1.1, -1.3, 1.5], 
 [-0.4, 0.4, -0.8, 0.7, -1.1, 0.9], 
 [0, 0, -0.6, 0.4, -0.8, 0.4], 
 [-0.2, 0.1, -0.3, 0.1, -0.3, 0.1], 
 [0, 0, -0.1, 0, -0.1, 0.1], 
 [-0.1, 0, -0.2, 0.1, -0.4, 0.1], 
 [-0.2, 0, -0.4, 0.1, -0.6, 0.1], 
 [-0.2, 0, -0.5, 0, -0.7, 0], 
 [-0.3, 0, -0.5, -0.1, -0.8, -0.1], 
 [0, 0, -0.6, -0.2, -0.9, -0.4], 
 [-0.3, -0.2, -0.6, -0.4, -0.8, -0.7], 
 [-0.3, -0.3, -0.5, -0.6, -0.8, -1], 
 [-0.2, -0.4, -0.4, -0.7, -0.6, -1.2], 
 [0, 0, -0.4, -0.9, -0.6, -1.4], 
 [-0.2, -0.5, -0.3, -1.1, -0.5, -1.7], 
 [-0.2, -0.6, -0.3, -1.3, -0.4, -2], 
 [-0.1, -0.7, -0.2, -1.5, -0.3, -2.3], 
 [-0.1, -0.8, -0.1, -1.7, -0.2, -2.6], 
 [0, -0.9, 0, -1.9, 0, -2.9], 
 [0, -1, 0.1, -2.1, 0.2, -3.2], 
 [0, 0, 0.3, -2.2, 0.4, -3.2], 
 [0.2, -1, 0.4, -1.9, 0.6, -2.7], 
 [0.2, -0.8, 0.5, -1.6, 0.8, -2.3], 
 [0.3, -0.7, 0.6, -1.3, 1, -1.9], 
 [0, 0, 0.7, -1.1, 1.1, -1.5], 
 [0.4, -0.4, 0.9, -0.8, 1.3, -1.1], 
 [0, 0, 1, -0.5, 1.5, -0.7], 
 [0.5, -0.2, 1.1, -0.3, 1.7, -0.3], 
 [0.6, 0, 1.2, 0, 1.7, 0.1], 
 [0.5, 0.1, 1, 0.3, 1.4, 0.6], 
 [0.4, 0.3, 0.8, 0.6, 1.2, 0.9], 
 [0.3, 0.3, 0.7, 0.7, 0.9, 1.1], 
 [0.3, 0.4, 0.5, 0.8, 0.7, 1.1], 
 [0.2, 0.4, 0.4, 0.7, 0.5, 1], 
 [0.1, 0.3, 0.2, 0.5, 0.3, 0.7], 
 [0.1, 0.2, 0.1, 0.3, 0.1, 0.3]
];

var origin = [200,100];
var isDown = false;
var cpos = [200, 100];
var lineoffset = [0, 0];
var totallinelength = 0;
var returninterval = false;
var momentuminterval = false;
var momentumscalex = d3.scale.linear();
var momentumscaley = d3.scale.linear();
var gravity = 0.3;
var inertia = 0.5;
var momentum = [0, 0];
var falloff = 0;
var linepos = [0, 0];

var size = {
  'x': 280,
  'y': 170
}

var svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height)
  .attr("tabindex", 1);

var circle = svg.append("circle")
  .attr("r", 78)
  .attr("cx", 149)
  .attr("cy", 119)
  .attr("class", "circle");

var bgd = lineparser(newpoints, origin, false);

var bgpath = svg.append("path")
  .attr("d", bgd)
  .attr("class", "blackline");
  
var path = svg.append("path")
  .attr("class", "line");

var dot1 = svg.append("circle")
  .attr("r", 2)
  .attr("cx", 133)
  .attr("cy", -8)
  .attr("class", "dot");

var dot2 = svg.append("circle")
  .attr("r", 2)
  .attr("cx", 174)
  .attr("cy", -8)
  .attr("class", "dot");

var grab = svg.append("circle")
  .attr("r", 2)
  .attr("cx", 200)
  .attr("cy", 100)
  .attr('opacity', 0)
  .attr("class", "grabber");

function lineparser(linevectors, origin, cursorpos) {
  var linelength = 0;
  cursorpos = cursorpos ? cursorpos : origin;
  var delta = getDelta([cursorpos[0], cursorpos[1]], [origin[0], origin[1]]);
  var offsets = [0, 0];
  var zero = [origin[0], origin[1]];
  var previousVector = [cursorpos[0], cursorpos[1], cursorpos[0], cursorpos[1], cursorpos[0], cursorpos[1]];

  // for calculating momentum effect on the line
  var thismomentum = momentum.slice();
  thismomentum[0] = isDown ? 0 : thismomentum[0];
  thismomentum[1] = isDown ? 0 : thismomentum[1];
  momentumscalex.domain([1, delta]).range([0, thismomentum[0]]);
  momentumscaley.domain([1, delta]).range([0, thismomentum[1]]);

  var returnstring = "M" + parseFloat(cursorpos[0] - thismomentum[0]) + ',' + parseFloat(cursorpos[1] - thismomentum[1]) + ' ';
  for (var i = 0; i < linevectors.length; i++) {
    var vector = linevectors[i].slice();
    vector = scaleVector(vector);
    linelength += Math.abs(vector[4]) + Math.abs(vector[5]);
    if (isDown && delta > linelength || returninterval !== false && delta > linelength) {
      vector = getRelativeVector(vector, zero, cursorpos, origin, offsets, delta, linelength);
    } else {
      vector = getStaticVector(vector, zero);
    }
    previousVector = vector;
    var coords = vector.join(',');
    returnstring += 'C' + coords + ' ';
  }
  totallinelength = linelength;
  return returnstring;
}

function movement() {
  if (cpos[0] > linepos[0]) {
    momentum[0]--;
    momentum[0] += inertia;
  } else {
    momentum[0]++;
    momentum[0] -= inertia;
  }
  if (cpos[1] > linepos[1]) {
    momentum[1] = -gravity;
  } else {
    momentum[1] = gravity;
  }
  cpos[0] += momentum[0];
  cpos[1] += momentum[1];
  momentum[0] = momentum[0] > 0 ? momentum[0] - falloff : momentum[0] + falloff;
  momentum[1] = momentum[1] > 0 ? momentum[1] - falloff : momentum[1] + falloff;
  falloff += 0.001;
  path.attr('d', lineparser(newpoints, origin, cpos));
}

function getStaticVector(vector, zero) {
  vector[0] += zero[0];
  vector[1] += zero[1];
  vector[2] += zero[0];
  vector[3] += zero[1];
  vector[4] += zero[0];
  vector[5] += zero[1];
  zero[0] = vector[4];
  zero[1] = vector[5];
  return vector;
}

function getRelativeVector(vector, zero, cursorpos, origin, offsets, delta, linelength) {
  offsets[0] += vector[4];
  offsets[1] += vector[5];
  zero[0] = origin[0] + offsets[0];
  zero[1] = origin[1] + offsets[1];
  var vector_delta = delta - linelength;

  if (delta > totallinelength) {
    // add correction for when cursor delta is higher than line length
  }
  
  var unit = (delta / vector_delta);
  var diff = [cursorpos[0] - zero[0], cursorpos[1] - zero[1]];
  var vector_offset = [
    (diff[0] / unit),
    (diff[1] / unit)
  ];
  var new_vector = [
    zero[0] + vector_offset[0],
    zero[1] + vector_offset[1]
  ];
  if (cursorpos[0] > zero[0]) {
    new_vector[0] = new_vector[0] > cursorpos[0] ? cursorpos[0] : new_vector[0];
  } else {
    new_vector[0] = new_vector[0] < cursorpos[0] ? cursorpos[0] : new_vector[0];
  }
  if (cursorpos[1] > zero[1]) {
    new_vector[1] = new_vector[1] > cursorpos[1] ? cursorpos[1] : new_vector[1];
  } else {
    new_vector[1] = new_vector[1] < cursorpos[1] ? cursorpos[1] : new_vector[1];
  }
  if (returninterval !== false && !isDown) {
    new_vector[0] -= momentumscalex(vector_delta);
    new_vector[1] -= momentumscaley(vector_delta);
    if (delta < 1) {
      clearInterval(returninterval);
      console.log("interval cleared");
    }
  }
  vector = [
    new_vector[0],
    new_vector[1],
    new_vector[0],
    new_vector[1],
    new_vector[0],
    new_vector[1]
  ];
  linepos = zero.slice();
  return vector;
}

function getChainDelta(z, va, vb, pv) {
  var oldDelta = getDelta([va[4] - z[0], va[5] - z[1]], [vb[4], vb[5]]);
  var newDelta = getDelta([va[4], va[5]], [pv[4], pv[5]]);
  var x = y = xdist = ydist = 0;
  if (newDelta != 0 && oldDelta != 0) {
    var changeFactor = Math.abs((newDelta - oldDelta) / newDelta);
    xdist = va[4] - pv[4];
    ydist = va[5] - pv[5];
    if (xdist) {
      var xdist2 = xdist * xdist;
      x = Math.sqrt(xdist2 * changeFactor);
    }
    if (ydist) {
      var ydist2 = ydist * ydist;
      y = Math.sqrt(ydist2 * changeFactor);
    }
  }
  return [x, y];
}

function getDelta(p1, p2) {
  var dx = p2[0] - p1[0];
  var dy = p2[1] - p1[1];
  var delta = Math.sqrt((dx * dx) + (dy * dy));
  return delta.toFixed(3);
}

function getOffset(p1, p2) {
  var xoffset = p1[0] - p2[0];
  var yoffset = p1[1] - p2[1];
  return [xoffset, yoffset];
}

function scaleVector(vector) {
  if (scale != 1) {
    for (var i = 0; i < vector.length; i++) {
      vector[i] = vector[i] * scale;
    }
  }
  return vector;
}

if (!initialized) {
  path.transition()
    .duration(100)
    .ease("linear")
    .attr("d", lineparser(zeropoints, [200, 120], false))
    .transition()
    .duration(300)
    .ease("sin-out")
    .attr("d", lineparser(newpoints, origin, false));

  dot1.transition()
    .delay(700)
    .duration(200)
    .ease("elastic-in")
    .attr("cx", 133)
    .attr("cy", 95);
  dot2.transition()
    .delay(700)
    .duration(250)
    .ease("elastic-in")
    .attr("cx", 174)
    .attr("cy", 80);
    
  initialized = true;
}

function mousedown() {
  momentum = [0, 0];
  isDown = (cpos[0] > origin[0] - 20 && cpos[0] < origin[0] + 20 && cpos[1] > origin[1] - 20 && cpos[1] < origin[1] + 20);
}
function mousemove() {
  if (isDown){
    var oldcpos = cpos;
    cpos = d3.mouse(this);
    momentum = [cpos[0] - oldcpos[0], cpos[1] - oldcpos[1]];
    path.attr('d', lineparser(newpoints, origin, cpos));
  }
}
function mouseup() {
  falloff = 0;
  cpos = d3.mouse(this);
  if (isDown) {
    isDown = false;
    returninterval = setInterval(movement, 20);
  }
}
svg.on('mousedown', mousedown);
svg.on('mousemove', mousemove);
svg.on('mouseup', mouseup);

</script>
